using Microsoft.EntityFrameworkCore;
using Portal_Aluno.Domain.Entities;

namespace Portal_Aluno.Infrastructure.Data.DbContexts;

public class AppDbContext : DbContext
{
    public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

    public DbSet<Aluno> Alunos => Set<Aluno>();
    public DbSet<Curso> Cursos => Set<Curso>();
    public DbSet<Disciplina> Disciplinas => Set<Disciplina>();
    public DbSet<CursoDisciplina> CursosDisciplinas => Set<CursoDisciplina>();
    public DbSet<Professor> Professores => Set<Professor>();
    public DbSet<Matricula> Matriculas => Set<Matricula>();
    public DbSet<Turma> Turmas => Set<Turma>();
    public DbSet<MatriculaTurma> MatriculasTurma => Set<MatriculaTurma>();
    public DbSet<Usuario> Usuarios => Set<Usuario>();

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        // aluno
        modelBuilder.Entity<Aluno>(b =>
        {
            b.ToTable("aluno");
            b.HasKey(x => x.Ra);
            b.Property(x => x.Ra).HasColumnName("ra").HasMaxLength(30);
            b.Property(x => x.Nome).HasColumnName("nome").HasMaxLength(150).IsRequired();
            b.Property(x => x.Email).HasColumnName("email").HasMaxLength(120).IsRequired();
            b.Property(x => x.DataNascimento).HasColumnName("datanascimento");
            b.Property(x => x.Celular).HasColumnName("celular").HasMaxLength(30);
            b.Property(x => x.Status).HasColumnName("status").HasMaxLength(30).IsRequired();
            b.Property(x => x.Cep).HasColumnName("cep").HasMaxLength(10).IsRequired();
            b.Property(x => x.Rua).HasColumnName("rua").HasMaxLength(150).IsRequired();
            b.Property(x => x.Numero).HasColumnName("numero").HasMaxLength(10);
            b.Property(x => x.Bairro).HasColumnName("bairro").HasMaxLength(70).IsRequired();
            b.Property(x => x.Cidade).HasColumnName("cidade").HasMaxLength(70).IsRequired();
            b.Property(x => x.Estado).HasColumnName("estado").HasMaxLength(2).IsRequired();
            b.Property(x => x.Pais).HasColumnName("pais").HasMaxLength(50).IsRequired();
            b.Property(x => x.Foto).HasColumnName("foto").HasMaxLength(255);
        });

        // curso
        modelBuilder.Entity<Curso>(b =>
        {
            b.ToTable("curso");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.Nome).HasColumnName("nome").HasMaxLength(100);
            b.Property(x => x.Grau).HasColumnName("grau").HasMaxLength(30);
            b.Property(x => x.CargaHoraria).HasColumnName("cargahoraria");
        });

        // disciplina
        modelBuilder.Entity<Disciplina>(b =>
        {
            b.ToTable("disciplina");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.Nome).HasColumnName("nome").HasMaxLength(100);
            b.Property(x => x.CargaHoraria).HasColumnName("cargahoraria");
            b.Property(x => x.LimiteFaltas).HasColumnName("limitefaltas");
        });

        // curso_disciplina
        modelBuilder.Entity<CursoDisciplina>(b =>
        {
            b.ToTable("curso_disciplina");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.CursoId).HasColumnName("curso_id");
            b.Property(x => x.DisciplinaId).HasColumnName("disciplina_id");
            b.Property(x => x.Semestre).HasColumnName("semestre");

            b.HasOne(x => x.Curso).WithMany(x => x.CursoDisciplinas).HasForeignKey(x => x.CursoId);
            b.HasOne(x => x.Disciplina).WithMany(x => x.CursoDisciplinas).HasForeignKey(x => x.DisciplinaId);
        });

        // professor
        modelBuilder.Entity<Professor>(b =>
        {
            b.ToTable("professor");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.Nome).HasColumnName("nome").HasMaxLength(150);
            b.Property(x => x.Email).HasColumnName("email").HasMaxLength(120);
            b.Property(x => x.Titulo).HasColumnName("titulo").HasMaxLength(50);
            b.Property(x => x.Status).HasColumnName("status").HasMaxLength(30);
            b.Property(x => x.Foto).HasColumnName("foto").HasMaxLength(255);
        });

        // matricula
        modelBuilder.Entity<Matricula>(b =>
        {
            b.ToTable("matricula");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.Ra).HasColumnName("ra").HasMaxLength(30);
            b.Property(x => x.CursoId).HasColumnName("curso_id");
            b.Property(x => x.Semestre).HasColumnName("semestre");
            b.Property(x => x.Turno).HasColumnName("turno").HasMaxLength(30);
            b.Property(x => x.DataMatricula).HasColumnName("datamatricula");
            b.Property(x => x.Status).HasColumnName("status").HasMaxLength(30);
            b.Property(x => x.FormaIngresso).HasColumnName("formaingresso").HasMaxLength(50);

            b.HasOne(x => x.Aluno).WithMany(x => x.Matriculas).HasForeignKey(x => x.Ra);
            b.HasOne(x => x.Curso).WithMany(x => x.Matriculas).HasForeignKey(x => x.CursoId);
        });

        // turma
        modelBuilder.Entity<Turma>(b =>
        {
            b.ToTable("turma");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.CursoId).HasColumnName("curso_id");
            b.Property(x => x.DisciplinaId).HasColumnName("disciplina_id");
            b.Property(x => x.Semestre).HasColumnName("semestre");
            b.Property(x => x.Ano).HasColumnName("ano");
            b.Property(x => x.ProfessorId).HasColumnName("professor_id");
            b.Property(x => x.Horario).HasColumnName("horario").HasMaxLength(100);
            b.Property(x => x.Sala).HasColumnName("sala").HasMaxLength(30);
            b.Property(x => x.Status).HasColumnName("status").HasMaxLength(30);

            b.HasOne(x => x.Curso).WithMany(x => x.Turmas).HasForeignKey(x => x.CursoId);
            b.HasOne(x => x.Disciplina).WithMany(x => x.Turmas).HasForeignKey(x => x.DisciplinaId);
            b.HasOne(x => x.Professor).WithMany(x => x.Turmas).HasForeignKey(x => x.ProfessorId);
        });

        // matricula_turma
        modelBuilder.Entity<MatriculaTurma>(b =>
        {
            b.ToTable("matricula_turma");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.MatriculaId).HasColumnName("matricula_id");
            b.Property(x => x.TurmaId).HasColumnName("turma_id");
            b.Property(x => x.Nota).HasColumnName("nota").HasPrecision(4,2);
            b.Property(x => x.Faltas).HasColumnName("faltas");
            b.Property(x => x.Situacao).HasColumnName("situacao").HasMaxLength(30);

            b.HasOne(x => x.Matricula).WithMany(x => x.MatriculasTurma).HasForeignKey(x => x.MatriculaId);
            b.HasOne(x => x.Turma).WithMany(x => x.MatriculasTurma).HasForeignKey(x => x.TurmaId);
        });

        // usuario
        modelBuilder.Entity<Usuario>(b =>
        {
            b.ToTable("usuario");
            b.HasKey(x => x.Id);
            b.Property(x => x.Id).HasColumnName("id");
            b.Property(x => x.Login).HasColumnName("login").HasMaxLength(50);
            b.Property(x => x.Senha).HasColumnName("senha").HasMaxLength(255);
            b.Property(x => x.Tipo).HasColumnName("tipo").HasMaxLength(30);
            b.Property(x => x.Referencia).HasColumnName("referencia_id");
            b.HasIndex(x => x.Login).IsUnique();
        });
    }
}
